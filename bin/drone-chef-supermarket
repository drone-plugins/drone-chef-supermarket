#!/usr/bin/env ruby

require "gli"

$LOAD_PATH.push File.expand_path("../../lib", __FILE__)

Signal.trap("INT") do
  abort
end

begin
  require "drone"
  require "drone/supermarket"
rescue LoadError
  require "rubygems"
  require "drone"
  require "drone/supermarket"
end

include GLI::App

program_desc "Drone Supermarket Plugin"

command :upload do |c|
  c.action do |_global_options, options, _args|
    c.flag [:u, :user], required: true
    c.flag [:k, :private_key], required: true, mask: true
    c.flag [:s, :server], default_value: "https://supermarket.chef.io"
    c.flag [:v, :ssl_verify], default_value: true
    c.flag [:d, :debug], default_value: ENV["DRONE_DEBUG"]

    Drone::Supermarket.new(options).execute!
  end
end

exit run(ARGV)
